{% extends 'base.html' %}
{% block metadescription %} All tenants {% endblock %}
{% load crispy_forms_tags %}
{% block content %} 
<br/>


<div class="container-fluid">
  <div class="row">

      <div class="row">
          <div class="d-flex align-items-center">
              <main class="text-center p-4 w-100">

                <div class="col">
                  <div class="card h-100">
                      <div class="card-body">
                          <span class="p-2">Name: {% if building %} {{building.name }} {% endif %}</span> <br>
                          <span class="p-2">Estate: {% if building.estate %} {{building.estate }} {% else %} Not Listed{% endif %}</span> <br>
                          <span class="p-2">Registered owner: {{building.registered_owner }}</span> <br>
                          <span class="p-2"> Address Line: {{building.address_line}} </span> <br>
                          <span class="p-2"> County: {{building.county}} </span> <br>
                          <span class="p-2"> Country: {{building.country}} </span> <br>
                          <span class="p-2"> Occupied Units: {{oc_units_count}} </span> <span class="p-2"> Unoccupied Units: {{em_units_count}} </span> <br>
                          <p class="card-text"></p>
                    </div>
                      <div class="card-footer">
                          <small class="text-muted">Status: {{building.get_building_status_display}}</small>
                          &nbsp;&nbsp;&nbsp;&nbsp; <small> <a href="{% url 'update-building-status' building.slug %}"> update </a> </small> &nbsp;&nbsp;
                          <small> <a href="{% url 'core:building_stats' building.slug %}"> stats </a> </small>
                      </div>
                  </div>
              </div>
              <br> 

              <div class="container">
                <div class="row">
                  <div class="col-sm-3">
                    <div class="list-group">
                      <h5 class='list-group-item list-group-item-action'>Building Menu</h5>
                      {% if user.is_manager %}
                      <a href="{% url 'managed-building-units' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">All Units</a>
                      <a href="{% url 'add-rental-unit' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Add rental unit</a>
                      <a href="{% url 'add-new-tenant' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Add Tenants</a>
                      <a href="{% url 'rent-and-utilities' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button"> Rent and Utilities </a>
                      <a href="{% url 'core:visits' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Visits</a>
                      <a href="{% url 'reports' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Reports 
                        <small class="position-absolute top-1 start-100 translate-middle badge rounded-pill bg-secondary">({{building_reports_count}})</small></a>
                      <a href="{% url 'building-complaints' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Complaints</a>
                      <a href="{% url 'core:evictions' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Evictions</a>
                      <a href="{% url 'core:move-out-notices' building.slug %}" title="submitted move out notices" type="button" class="list-group-item list-group-item-action" role="button">Move Out Notices</a>
                      {% endif %}
                    </div>
                  </div>
                  <div class="col-sm-9">
                    <div class="row">
                      <div class="col-8 col-sm-12">
                        <div class="card card-body mb-2">
                          <h4 class="card-header text-center"> Query Tenants</h4>
                          <form class="no-padding" method="get">
                              {{tenants.form|crispy}}
                              <br>
                              <div class="form-group text-center">
                                  <button class="btn btn-outline-secondary" type="submit">Search</button>
                              </div>
                          </form>
                        </div>
                        <div class="card card-body">
                          <input class="form-control" id="myInput" type="text" placeholder="table search..">
                          <div class="table-responsive">
                          <table class="table table-striped table-hover">
                            <caption> Tenants </caption>
                              <thead>
                                <tr>
                                  <th scope="col">Full Name</th>
                                  <th scope="col">Occupied Unit</th>
                                  <th scope="col"> Unit Maintanance Status </th>
                                  <th scope="col"> Active Phone </th>
                                  <th scope="col">Update</th>
                                </tr>
                              </thead>
                              <tbody id='ourTable'>
                                  {% for tenant in tenants.qs %}
                                <tr>
                                  <th scope="row">{{ tenant.associated_account }}</th>
                                  <td>{{ tenant.rented_unit.unit_number }}</td>
                                  <td> {{ tenant.rented_unit.get_maintanance_status_display}} </td>
                                  <td> {{ tenant.active_phone_number}} </td>
                                  <td><a href="{% url 'view-tenant' building.slug tenant.associated_account.username %}"> <h5> view </h5> </a></td>
                                </tr>
                                {% empty %}
                                <tbody>
                                  <tr>
                                    <td>
                                <p> Nothing to display! </p>
                                    </td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                  
                              </tbody>
                          </table>
                          </div>
                  </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              </main>
          </div>
      </div>
  </div>
</div>

{% endblock %}