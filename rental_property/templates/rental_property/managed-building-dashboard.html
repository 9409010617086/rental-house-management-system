{% extends 'base.html' %}
{% block metadescription %} Building Dashboard {% endblock %}
{% load crispy_forms_tags %}
{% block content %} 
<nav class="container mt-3">
  <ol class="breadcrumb bg-light p-2 rounded-2">
      <li class="breadcrumb-item active">Dashboard</li>
  </ol>
</nav>


<div class="container mb-3">
  <div class="row">

      <div class="row">
          <div class="d-flex align-items-center">
              <main class="text-center w-100">

                <div class="container card p-0 mb-2">
                  <div class="card-header text-center w-100 text-uppercase">
                    {{building.name}}
                  </div>
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="card border-0">
                        <div class="card-body">
                          <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                              <strong> Estate </strong>
                              <span> {% if building.estate %} {{building.estate }} {% else %} Not Listed{% endif %} </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                                <strong> Registered owner </strong>
                                <span>  {{building.registered_owner }}</span>
                              </li>
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                                <strong> Address Line: </strong>
                                <span>{{building.address_line}}, {{building.county}}</span>
                              </li>
                          <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                            <strong> Registered Country </strong>
                            <span> {{building.country}}</span>                                  
                          </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="card border-0">
                        <div class="card-body">
                          <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                              <strong> Current Status </strong>
                              <span> {{building.get_building_status_display}}</span>                                  
                            </li>
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                              <strong> Occupied Units </strong>
                              <span> {{oc_units_count}}</span>                                  
                            </li>
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                              <strong> Unoccupied Units </strong>
                              <span> {{em_units_count}}</span>                                  
                            </li>
                            <li class="list-group-item d-flex justify-content-between border-0 align-items-center">
                              <span> <a class="btn btn-outline-primary" title="click to update status" href="{% url 'update-building-status' building.slug %}"> update </a> </span>
                              <span><a class="btn btn-outline-info" title="click to view stats" href="{% url 'core:building_stats' building.slug %}"> stats </a></span>       
                            </li>
                          </ul>
                          </div>
                      </div>
                    </div>
                  </div>
                </div>

              <div class="container">
                <div class="row">
                  <div class="col-sm-3">
                    <div class="list-group">
                      <h5 class='list-group-item list-group-item-action'>Building Menu</h5>
                      {% if user.is_manager %}
                      <a href="{% url 'managed-building-units' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">All Units</a>
                      <a href="{% url 'add-rental-unit' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Add rental unit</a>
                      <a href="{% url 'add-new-tenant' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Add Tenants</a>
                      <a href="{% url 'core:general_communications' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">General Communications</a>
                      <a href="{% url 'hired_personnel' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Hired Personnel</a>
                      <a href="{% url 'work_orders' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Work Orders</a>
                      <a href="{% url 'rent-and-utilities' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button"> Rent and Utilities </a>
                      <a href="{% url 'maintanance_notices' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button"> Maintanance Notices </a>
                      <a href="{% url 'core:visits' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Visits</a>
                      <a href="{% url 'reports' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Reports 
                        <small class="position-absolute top-1 start-100 translate-middle badge rounded-pill bg-secondary">({{building_reports_count}})</small></a>
                      <a href="{% url 'building-complaints' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Complaints</a>
                      <a href="{% url 'core:evictions' building.slug %}" type="button" class="list-group-item list-group-item-action" role="button">Evictions</a>
                      <a href="{% url 'core:move-out-notices' building.slug %}" title="submitted move out notices" type="button" class="list-group-item list-group-item-action" role="button">Move Out Notices</a>
                      {% endif %}
                    </div>
                  </div>
                  <div class="col-sm-9">
                    <div class="row">
                      <div class="col-8 col-sm-12">
                        <div class="card card-body mb-2">
                          <h4 class="card-header text-center"> Search Tenants</h4>
                          <form class="no-padding" method="get">
                              {{tenants.form|crispy}}
                              <br>
                              <div class="form-group text-center">
                                  <button class="btn btn-outline-secondary" type="submit">Search</button>
                              </div>
                          </form>
                        </div>
                        <div class="card card-body">
                          <input class="form-control" id="myInput" type="text" placeholder="table search..">
                          <div class="table-responsive">
                          <table class="table table-striped table-hover">
                            <caption> Tenants </caption>
                              <thead>
                                <tr>
                                  <th scope="col">Full Name</th>
                                  <th scope="col">Occupied Unit</th>
                                  <th scope="col"> Unit Maintanance Status </th>
                                  <th scope="col"> Active Phone </th>
                                  <th scope="col">Update</th>
                                </tr>
                              </thead>
                              <tbody id='ourTable'>
                                  {% for tenant in tenants.qs %}
                                <tr>
                                  <th scope="row">{{ tenant.associated_account }}</th>
                                  <td>{{ tenant.rented_unit.unit_number }}</td>
                                  <td> {{ tenant.rented_unit.get_maintanance_status_display}} </td>
                                  <td> {{ tenant.active_phone_number}} </td>
                                  <td><a href="{% url 'view-tenant' building.slug tenant.associated_account.username %}"> <h5> view </h5> </a></td>
                                </tr>
                                {% empty %}
                                <tbody>
                                  <tr>
                                    <td>
                                <p> Nothing to display! </p>
                                    </td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                  
                              </tbody>
                          </table>
                          </div>
                  </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              </main>
          </div>
      </div>
  </div>
</div>

{% endblock %}